<!-- categorization variables -->
{% include categorization.html %}

{% assign parties_data = site.data.agents.organizations.[track_data.config.country].parties %}

<!-- Parties logo path -->
{% include agents_logo_path.html %}

<!-- categorization counters -->
{% include categorization_counters.html %}

<div class="border my-3 p-3 bg-body rounded shadow-sm">
    <h6 class="border-bottom pb-2">{{ site.data.ui-text[site.locale].track_info_label | default: "Data and info about" }} {{ track_data.context.name }}</h6>
    <div class="row pt-2">
        <!-- % assign not_achieved = promises | where_exp: "item", "item.status contains 'Broken' or item.status contains 'Not started' or item.status contains 'In progress'" % 
                % assign not_achieved_percent = not_achieved | times: 100 | divided_by: total % -->
        <p>
            <b>Comenzó el</b>  {{ track_data.context.from }} <b>hasta</b>  {% if track_data.context.to %} {{ track_data.context.to }} {% else %} Actualidad {% endif %} <b>durante</b> 
            <span id="days-in-office"><i class='loading'>Loading...</i></span> días
        </p>
        <p>
            <b>Total compromisos electorales del gobierno registrados: </b> {{ promises | size }} 
            de los cuales <span class="text-danger"> el {{ not_achieved_percent }}% no se han cumplido</span> y <span class="text-success"> el % sí.</span>
        </p> 
        <p>
            <b>Total compromisos electorales de la oposición registrados: </b> {{ opposition_promises | size }} 
            de los cuales <span class="text-danger"> el {{ not_achieved_percent }}% no se han cumplido</span> y <span class="text-success"> el % sí.</span>
        </p>
    </div>
</div>

<div class="border my-3 p-3 bg-body rounded shadow-sm"> 
    <h6 class="border-bottom pb-2 d-flex justify-content-between align-items-start">
        <span class="align-self-center">
            {{ site.data.ui-text[site.locale].track_promises_label | default: "Tracking promises of" }} {{ track_data.context.name }}
        </span>
        <a class="btn btn-sm btn-primary" href="{{page.url}}/register-promise">
            <i class="fas fa-fw fa-plus"></i> Registrar promesa
        </a>
    </h6>
    <div class="row pt-2">
        <div class="row">
            <div class="col-md-3 mb-2">
                <ul class="list-group small">
                    <!-- <li class="list-group-item list-group-item inauguration-time-container">
                        <i class="fas fa-fw fa-home fa-fw"></i>
                        <b id="inauguration-time">Days Till Inauguration: <span id="inauguration-days"><i class='loading'>Loading...</i></span></b>
                    </li> -->
                    <input type="text" class="d-none" name="inauguration" id="inauguration" value="{{ track_data.context.from }}">
                    <li class="list-group-item bg-dark text-light">
                        {{ site.data.ui-text[site.locale].select_to_label | default: "Select to" }}
                        <b>{{ site.data.ui-text[site.locale].filter_by_label | default: "filter by" | downcase }}
                        {{ site.data.ui-text[site.locale].status_label | default: "status" | downcase }} </b>
                    </li>

                    {% for status in statuses %}
                        <li class="list-group-item list-group-item-{{ status.color }} list-group-item-action d-flex justify-content-between align-items-start" data-list-facet="list-status" data-facet-value="{{ status.name }}" >
                            <span>{{ site.data.ui-text[site.locale].[status.lang_label] }}
                            <i class="fas fa-fw fa-{{ status.icon }} text-{{ status.color }}" title="{{ site.data.ui-text[site.locale].[status.lang_label] | default: status.name }}"></i></span>
                            <span class="badge bg-dark rounded-pill">{{ status_counters[forloop.index0] }}</span>
                        </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="col-md-9"> 
                <ul class="list-group small">
                    <li class="list-group-item bg-dark text-light">
                        {{ site.data.ui-text[site.locale].select_to_label | default: "Select to" }}
                        <b>{{ site.data.ui-text[site.locale].filter_by_label | default: "filter by" | downcase}} 
                        {{ site.data.ui-text[site.locale].category_label | default: "category" | downcase}} </b>
                    </li>
                </ul>
                {% assign counter = 0 %}
                {% for category in categories %}
                    {% if category_counters[forloop.index0] > 0 %}
                        {% assign counter = counter | plus: 1%}
                        {% assign mod = counter | modulo: 3 %}
                        {% if mod == 1  %}
                            <ul class="list-group list-group-horizontal-sm small">
                        {% endif %}
                    
                        <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-start" data-list-facet="list-category" data-facet-value="{{ category.name }}" data-select-single="true">
                            <span> {{ category.name }} 
                            <i class="text-muted fas fa-fw fa-{{ category.icon }} " title="{{ category.name }}"></i></span>
                            <span class="badge bg-dark rounded-pill">{{ category_counters[forloop.index0] }}</span>
                        </li>
                        {% if mod == 0  %}
                            </ul>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                {% if mod == 1  %}
                    </ul>
                {% endif %}
                </ul>
            </div>
        </div>
    </div>
    <div class="promises row pt-2" id="promises">
        <div class="row promises__search-row py-2">
            <div class="col mb-2">
                <form action="#" class="form-inline">
                    <div class="input-group">
                      <input type="text" class="form-control form-control-sm search" id="search" name="search" placeholder="{{ site.data.ui-text[site.locale].search_label | default: 'Search' }}">
                      <div class="input-group-append list-filter-reset">
                        <button class="btn btn-sm btn-outline-secondary" type="button">
                            <i class="fas fa-fw fa-rotate"></i> {{ site.data.ui-text[site.locale].delete_filters_label | default: "Delete filters" }}
                        </button>
                      </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="table-responsive-md promises__table">
            <table class="table">
                <thead> 
                <tr class="bg-dark text-light">
                    <th></th>
                    <th>{{ site.data.ui-text[site.locale].promise_label | default: "Category" }}</th>
                    <th>{{ site.data.ui-text[site.locale].promise_label | default: "Promise" }}</th>
                    <th>{{ site.data.ui-text[site.locale].status_label | default: "Status" }}</th>
                    <th></th>
                </tr>
                </thead>

                <tbody class="list">
                <!-- add color to each policy -->
                {% for item_data in items %}
                    {% assign item = item_data[1] %}
                    {% assign status = statuses | where: "name", item.status | first %}
                    {% assign category = categories | where: "name", item.category | first %}
                    {% assign party = parties_data | where: "name", item.party | first %}
                    <tr class="list-group-item-{{ status.color }}">
                        <td class="list-party" style="color:{{ party.color }};">
                            {% assign exists = false %}
                            {% assign party_name = party.name | slugify %}
                            {{ logos_path }}
                            {% assign path = logos_path | append: party_name | append: '.gif'  %}

                            {% for static_file in site.static_files %}
                                {% if static_file.path == path %}
                                    {% assign exists = true %}
                                {% endif %}
                            {% endfor %}
                            {% if exists %}
                                <img src="{{ path }}" alt="{{ party.name }}" width="35" height="35">
                                <span class="d-none">{{ party.name }}</span>
                            {% else %}
                                {{ party.name }}
                            {% endif %}
                        </td>
                        <td>
                            <span class="list-category">{{ item.category }}</span>
                            <span><i class="text-muted fas fa-fw fa-{{ category.icon }} " title="{{ category.name }}"></i></span>
                        </td>
                        <td class="list-text">
                            <span><b>{{ item.title }}:</b></span>
                            <span>{{ item.description }}</span>
                        </td>
                        <td>
                            <span class="d-none sr-only list-status">{{ item.status }}</span>
                            <span>{{ site.data.ui-text[site.locale].[status.lang_label] | default: status.name }}</span>
                            <i class="fas fa-fw fa-{{ status.icon }} text-{{ status.color }}" title="{{ site.data.ui-text[site.locale].[status.lang_label] | default: status.name }}"></i>
                        </td>
                        <td class="text-center">
                            <a class="btn btn-primary" href="{{ page.dir }}{{item.party | slugify | append: '_' }}{{ item.title | slugify }}">
                                <span class="d-inline-block align-middle"><i class="fas fa-fw fa-angle-right"></i></span>
                            </a>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>  
    </div>
</div>   