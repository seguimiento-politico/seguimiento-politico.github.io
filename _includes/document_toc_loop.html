{% assign index = 0 %}
{% assign level = include.level %}

{% if include.level < levels %}
    {% for item in include.position %}
        {% for element in item %}
            {% if element[0] == "chapter" %}
                {% assign index = index | plus: 1 %}
                <li>
                    {% if level > 0 %}
                        {% assign current = include.current | append: "." | append: index %}
                        <a href="#{{element[1].title | slugify}}" class="">{{include.current_index}}.{{index}}. {{ element[1].title }}</a>
                    {% else %}
                        <a href="#{{element[1].title | slugify}}" class="">{{index}}. {{ element[1].title }}</a>
                    {% endif %}
                    
                    <ul>   
                        {% if element[1].children %}
                            {% assign level = include.level | plus: 1 %}
                            {% assign content = element[1].children %}
                            {% if level > 0 %}
                                {% assign current = include.prev_index | append: "." | append: index %}
                            {% else %}
                                {% assign current = index %}
                            {% endif %}
                            {% include document_toc_loop.html level=level prev_index=index current_index=current position=content %} 
                        {% endif %}
                    </ul>
                </li>    
            {% endif %}
        {% endfor %}
    {% endfor %}
    {% assign level = level | minus: 1 %}
    {% assign index = include.prev_index %}
{% endif %}